<AuFieldset as |f|>
  <f.legend @skin={{this.skin}} @required={{false}}>
    {{t "utility.variables"}}
  </f.legend>
  <f.content class="au-u-1-1">
    <div class="au-o-flow">

      {{!-- <AuLabel>{{t "utility.variable"}}</AuLabel>
      <AuInput
        value={{this.selectedValue}}
        {{on "input" this.setVariableValue}}
      />

      <AuLabel>{{t "utility.type"}}</AuLabel>
      <PowerSelect
        @searchField="label"
        @options={{this.variableTypes}}
        @placeholder={{t "utility.search-placeholder"}}
        @loadingMessage={{t "utility.loading"}}
        @selected={{this.selectedType}}
        @onChange={{this.setVariableType}}
        @triggerId="variableTypes"
        as |type|
      >
        {{type.label}}
      </PowerSelect> --}}

      {{#if @variables}}
        <AuTable>
          <:header>
            <tr>
              <th>{{t "utility.variable"}}</th>
              <th>{{t "utility.type"}}</th>
              <th></th>
            </tr>
          </:header>
          <:body>
            {{#each @variables as |variable|}}
              <tr>
                <td>
                  <AuInput
                    value={{variable.value}}
                    @error={{variable.error.value}}
                    {{on "input" (fn this.setVariableValue variable)}}
                  />
                  <ErrorMessage @error={{variable.error.value}} />
                </td>
                {{! template-lint-disable no-inline-styles }}
                <td style="width: 50%;">
                  <div
                    class={{if variable.error.type "ember-power-select--error"}}
                  >
                    <PowerSelect
                      @allowClear={{false}}
                      @searchEnabled={{false}}
                      @options={{this.variableTypes}}
                      @loadingMessage={{t "utility.loading"}}
                      @selected={{find-by-value
                        this.variableTypes
                        variable.type
                      }}
                      @onChange={{fn this.setVariableType variable}}
                      as |type|
                    >
                      {{type.label}}
                    </PowerSelect>
                    <ErrorMessage @error={{variable.error.type}} />
                  </div>
                  {{#if (eq variable.type "codelist")}}
                    <PowerSelect
                      @triggerClass="au-u-margin-top-tiny"
                      @allowClear={{false}}
                      @searchEnabled={{false}}
                      @options={{this.codeLists}}
                      @selected={{variable.codeList}}
                      @onChange={{fn this.updateCodelist variable}}
                      as |codeList|
                    >
                      {{codeList.label}}
                    </PowerSelect>
                    <ul
                      class="au-c-list-help au-c-help-text au-c-help-text--secondary"
                    >
                      {{#each variable.codeList.concepts as |option|}}
                        <li class="au-c-list-help__item">{{option.label}}</li>
                      {{/each}}
                    </ul>
                    <ErrorMessage @error={{variable.error.codelist}} />
                  {{/if}}
                </td>
                <td>
                  <AuButton
                    @skin="naked"
                    @icon="bin"
                    @alert={{true}}
                    {{on "click" (fn this.removeVariable variable)}}
                  >
                    {{t "utility.delete"}}
                  </AuButton></td>
              </tr>
            {{/each}}
          </:body>
        </AuTable>
      {{/if}}

      <AuButton
        @skin="secondary"
        @width="block"
        @icon="plus"
        {{on "click" this.addVariable}}
      >{{t "utility.add-variable"}}</AuButton>

    </div>
  </f.content>
</AuFieldset>